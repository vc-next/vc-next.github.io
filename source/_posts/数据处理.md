---
uuid: 6de0a5a0-6072-11ec-bf63-672e56567b3e
title: 数据处理
date: 2021-12-19 10:21:52
tags:
---

### 数据处理

1.  Number.prototype.toLocaleString

```js
var number = 123456.789;

// 要求货币格式
console.log(number.toLocaleString('de-DE', { style: 'currency', currency: 'EUR' }));
// → 123.456,79 €

// 日元不使用小数位
console.log(number.toLocaleString('ja-JP', { style: 'currency', currency: 'JPY' }))
// → ￥123,457

// 限制三位有效数字
console.log(number.toLocaleString('en-IN', { maximumSignificantDigits: 3 }));
// → 1,23,000

254..toString(16) // 'fe'
254..toLocaleString(16) // '254'
```

2.  Date.prototype.toLocaleString

```js
const date = new Date();
date.toLocaleString('zh');    // 2018-4-4 15:08:38
date.toLocaleString('en-US');    // 4/4/2018, 3:08:38 PM
```

3.  Array.prototype.toLocaleString

```js
var prices = ['￥7', 500, 8123, 12];
prices.toLocaleString('ja-JP', { style: 'currency', currency: 'JPY' });
// "￥7,￥500,￥8,123,￥12"
```

4.  String.prototype.replace

```js
function replacer(match, p1, p2, p3, offset, string) {
  // p1 is nondigits, p2 digits, and p3 non-alphanumerics
  return [p1, p2, p3].join(' - ');
}
var newString = 'abc12345#$*%'.replace(/([^\d]*)(\d*)([^\w]*)/, replacer);
console.log(newString);  // abc - 12345 - #$*%
```

5.  String.prototype.padStart/padEnd

```js
const str1 = '5';

console.log(str1.padStart(2, '0'));
// expected output: "05"

const fullNumber = '2034399002125581';
const last4Digits = fullNumber.slice(-4);
const maskedNumber = last4Digits.padStart(fullNumber.length, '*');

console.log(maskedNumber);
// expected output: "************5581"
```

6.  Array.prototype.reduce

```js
const array1 = [1, 2, 3, 4];
const reducer = (previousValue, currentValue) => previousValue + currentValue;

// 1 + 2 + 3 + 4
console.log(array1.reduce(reducer));
// expected output: 10

// 5 + 1 + 2 + 3 + 4
console.log(array1.reduce(reducer, 5));
```

7.  Math.random

```js
var list = [1, 2, 3, 4, 5, 6, 7, 8, 9];
console.log(list.sort(function() {
    return Math.random() - 0.5
}));
// [4, 8, 2, 9, 1, 3, 6, 5, 7]
// random 分布图
class Random {
  constructor(count = 100, width = 400, height = 300) {
    this.count = count
    this.width = width
    this.height = height
    this.root = document.createElement('canvas')
    this.root.width = `${width}`
    this.root.height = `${height}`
    this.canvas = this.root.getContext('2d')
    this.xScale = width / count
    this.yScale = height / count
    this.decision = count.toString().length - 1
  }
  random(n) {
    switch (n) {
      case 1:
        return Math.random()
      case 2:
        return Math.random() * Math.random()
      case 3:
        return Math.random() * Math.random() * Math.random()
      case 4:
        return Math.random() * Math.random() * Math.random() * Math.random()
      default:
        return Math.random()
    }
  }
  create(n) {
    const logs = {}
    for (let i = 0, count = this.count, k, v; i < count; i++) {
      // v = + new Function(`return ${Array(4).fill('Math.random()').join('*')}`)()  效率低 low effciency
      v = this.random(n)
      k = v.toFixed(this.decision)
      if (!logs[k]) {
        logs[k] = 1
      } else {
        logs[k]++
      }
    }
    return logs
  }
  draw() {
    const data = this.create(4)
    const canvas = this.canvas
    const width = this.width
    const height = this.height
    const count = this.count
    const decision = Math.max(Math.pow(10, this.decision - 1), 10)
    canvas.fillStyle = 'blue'
    let h
    for (let [k, v] of Object.entries(data)) {
      h = v / count * height * decision
      canvas.fillRect(width * k, height - h, 1, h);
    }
  }
  mount(selector) {
    const root = document.querySelector(selector)
    if (root) {
      root.appendChild(this.root)
    }
  }
}

const r = new Random(9000)
r.mount('.data')
r.draw()
```

8.  new Set

```js
const my_array = [1, 2, 2, 3, 3, 4, 5, 5]
const unique_array = [...new Set(my_array)];
console.log(unique_array); // [1, 2, 3, 4, 5]
```

9.  String.prototype.trim

```js

```

10. Array.prototype.splice

不要用 delete arr[2]

```js
const  arr = [1,4,7,8];
delete arr[2] // arr = [1,4,empty,8]
arr.splice(2,1) // arr = [1,4,8]
```

11. JSON.stringify/parse

```js
var person = {name :'Saad', age : 26, department : {ID : 15, name : "R&D"} };
var stringFromPerson = JSON.stringify(person);
/* stringFromPerson 结果为 "{"name":"Saad","age":26,"department":{"ID":15,"name":"R&D"}}"   */
var personFromString = JSON.parse(stringFromPerson);
/* personFromString 的值与 person 对象相同  */
```

12. Object.defineProperty

```js
const object1 = {};

Object.defineProperty(object1, 'property1', {
  value: 42,
  writable: false
});

object1.property1 = 77;
// throws an error in strict mode

console.log(object1.property1);
// expected output: 42
```

13. delete

```js
var trees = ["redwood","bay","cedar","oak","maple"];
delete trees[3];
if (3 in trees) {
   // 这里不会执行
}
```

14. Array.prototype.length

```js
var trees = ["redwood","bay","cedar","oak","maple"];
delete trees[3];
trees.length = 0
```

15. [new Function](https://zh.javascript.info/new-function)

```js
function getFunc() {
  let value = "test";
  let func = new Function('alert(value)');
  return func;
}

getFunc()(); // error: value is not defined
```

16. String.prototype.flat

```js
// ES6
[1, [2, [3]]].flat(2)  // [1, 2, 3]
// ES3/5
function flatten(arr) {
    var result = [];
    for (var i = 0, len = arr.length; i < len; i++) {
        if (Array.isArray(arr[i])) {
            result = result.concat(flatten(arr[i]))
        } else {
            result.push(arr[i])
        }
    }
    return result;
}

// ES6
function flatten(arr) {
    while (arr.some(item => Array.isArray(item))) {
        arr = [].concat(...arr);
    }
    return arr;
}

function flatten(arr){
  return arr.toString().split(',')
}
```

17. Array.prototype.sort

```js
const arr = ['12', '22', '13', 1, 2, '3'];
arr.sort() // [1, '12', '13', 2, '22', '3']
arr.sort((a, b) => a-b) // [1, 2, '3', '12', '13', '22']
```

18. [Math.random](https://juejin.cn/post/6844903924512587783)

```js
// random color
Math.random().toString(16).slice(4,10)
// random string
Math.random().toString(36).substr(2)
// random number in specified range
const max = 100
const min = 10
Math.random() * (max - min) + min
// random order
const arr = ['A', 'B', 'C', 'D', 'E', 'F', 'G']
arr.sort(() => Math.random() - 0.5)
```

19. JSON.stringify/parse

```js
const obj = {
  a: 1,
  b: 2,
  c: 3,
  d: ['34','45']
}
JSON.stringify(obj) // JSON.stringify(obj)
JSON.parse('{"a":1,"b":2,"c":3,"d":["34","45"]}') // {a: 1, b: 2, c: 3, d: Array(2)}
```

20. Array.prototype.filter

```js
const arr = [undefined, null, "", 0, false, NaN, 1, 2].filter(Boolean); // [1, 2]
```
