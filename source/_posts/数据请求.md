---
uuid: e6dad790-6073-11ec-8062-8dea7659a7ab
title: 数据请求
date: 2021-12-19 10:32:25
tags:
---

1.  [new XMLHttpRequest](https://segmentfault.com/a/1190000004322487)

> 灵活的 http 请求构造器

-   status
-   error
-   timeout
-   formData
-   request/response
-   sync/async

最基本的 HTTP 请求代码片段

```js
const xhr = new XMLHttpRequest()
xhr.timeout = 1000
xhr.addEventListener("load", function onload(){})
xhr.addEventListener('error',function onerror(){})
xhr.addEventListener('timeout',function ontimeout(){})
xhr.open("GET", "https://www.example.org/example.txt",true)
xhr.send()
```

结合 [formData](https://zh.javascript.info/formdata) 发送数据

```js
const xhr = new XMLHttpRequest()
const data = new FormData()
data.set('id','10001')
data.append('name','hello world')
data.append('addr','test world')
xhr.timeout = 1000
xhr.addEventListener("load", function onload(){})
xhr.addEventListener('error',function onerror(){})
xhr.addEventListener('timeout',function ontimeout(){})
xhr.open("POST", "https://www.example.org/example.txt",true)
xhr.send(data)
```

-   在哪可以看到 formData 数据，在 network的 可以查看请求有个 Content-Type: multipart/form-data; boundary=----WebKitFormBoundary4QTU9gLJlwuu2vTn，然后在 PayLoad 可以看到对应的 formData 数据
-   formData 必须是 POST 方式

```text
------WebKitFormBoundary4QTU9gLJlwuu2vTn
Content-Disposition: form-data; name="id"

10001
------WebKitFormBoundary4QTU9gLJlwuu2vTn
Content-Disposition: form-data; name="name"

hello world
------WebKitFormBoundary4QTU9gLJlwuu2vTn
Content-Disposition: form-data; name="addr"

test world
------WebKitFormBoundary4QTU9gLJlwuu2vTn--
```

Node Koa framework 的中间件 @koa/multer 支持 formData 解析

2.  [Fetch](https://zh.javascript.info/fetch)

header、response、request

```js
fetch('http://example.com/movies.json')
  .then(function(response) {
    return response.json();
  })
  .then(function(myJson) {
    console.log(myJson);
  });
```

-   header

```js
const content = 'Hello World';
const myHeaders = new Headers();
myHeaders.append('Content-Type', 'text/plain');
myHeaders.append('Content-Length', content.length.toString());
myHeaders.append('X-Custom-Header', 'ProcessThisImmediately');
```

-   request

```js
const myHeaders = new Headers();

const myRequest = new Request('flowers.jpg', {
  method: 'GET',
  headers: myHeaders,
  mode: 'cors',
  cache: 'default',
});

fetch(myRequest)
  .then(response => response.blob())
  .then(myBlob => {
    myImage.src = URL.createObjectURL(myBlob);
  });
```

-   response

```js
const myBody = new Blob();

addEventListener('fetch', event => {
  // ServiceWorker intercepting a fetch
  event.respondWith(
    new Response(myBody, {
      headers: { 'Content-Type': 'text/plain' }
    })
  );
});
```

-   fetch的取消比较隐蔽，但可以借助 [AbortController.abort()](https://developer.mozilla.org/zh-CN/docs/Web/API/AbortController/abort)
-   Response 提供了多种基于 promise 的方法，来以不同的格式访问 body,我们只能选择一种读取 body 的方法

3.  new Image

-   单点发送
-   不需要挂载 DOM
-   回调简单
-   async

```js
const logger = new Image()
logger.src = 'https://abc.com/trace?name=id&time=2022'
logger.onload = e =>{}
```

4.  JSONP

```html
<html>
  <body>
    <div>
      receive <span id="qwerty"> </span>
    </div>
  </body>
  <script>
    function callfun(data) {
      document.getElementById('qwerty').innerHTML = data;
    }
  </script>
  <script src="http://127.0.0.1:10010/js?call=callfun"></script>
</html>
```

```js
'use strict';

const Controller = require('egg').Controller;
class JsonpController extends Controller {
  async index() {
    const { ctx } = this;
    console.log(ctx.query);
    ctx.set('content-type', 'text/javascript');
    ctx.body = ctx.query.call + '("nihao")';
  }
}
```

4.  window.location.href
5.  window.open
6.  form.submit
